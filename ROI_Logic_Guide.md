# ROI Engine Logic Guide

本文档旨在清晰解释 **ROI Engine** 如何根据用户输入来**推荐投放量**、**分配磁贴**以及进行**双通道收益计算**。

## 1. 投放量推荐 (Total Magnet Recommendation)

系统不再根据粉丝数简单推荐，而是基于**“Premium Validator”验证逻辑**，根据创作者的**月营收能力** (Monthly Revenue Capacity) 来推荐 Pilot 规模。

**公式**：
`月营收能力 = 付费订阅数 (Paid Subscribers) × 平均订阅费 (ARPPU)`

**推荐阶梯**：

| 月营收能力 (Monthly Revenue) | 推荐投放量 (Total Magnets) | 投入成本 (@$20/个) | 逻辑说明 |
| :--- | :--- | :--- | :--- |
| **> $80,000** | **3,000 个** | $60,000 | **Premium Batch**。适用于高营收头部创作者。 |
| **$40,000 - $80,000** | **2,000 个** | $40,000 | **Standard Batch**。大部分成熟创作者的甜蜜点。 |
| **< $40,000** | **1,500 个** | $30,000 | **Entry Batch**。最小起订量，高门槛准入。 |

---

## 2. 磁贴分配策略 (Allocation Strategy)

确定总投放量后，系统会根据用户选择的 **Plan Type** 将磁贴分配给“免费用户” (Free) 和“付费用户” (Paid)。

### Plan A: Growth Only (纯增长模式)
*   **目标**：全力拉新，将免费用户转化为付费用户。
*   **分配规则**：
    *   **Free Allocation: 100%**
    *   **Paid Allocation: 0%**
*   *例子*：推荐 1500 个磁贴 → 全部发给免费用户。

### Plan B: Growth + Retention (增长+留存混合模式)
*   **目标**：在拉新的同时，向一部分现有付费用户发放磁贴以提升留存。
*   **分配规则**：
    *   **Rule**: 优先保障付费用户测试组 (约 15%)，剩余给免费用户。
    *   **Paid Allocation**: `max(200, 15% * Total)`
    *   **Free Allocation**: `Total - Paid`
*   *例子 (1500 Total)*：
    *   Paid: `max(200, 1500 * 0.15 = 225)` = **225 个**
    *   Free: `1500 - 225` = **1275 个**

---

## 3. 双通道收益计算 (Dual Track Calculation)

ROI 是由 **Track A (增长)** 和 **Track B (留存)** 两部分收益相加得出的。

### Track A: Growth (拉新收益)
*   **原理**：磁贴作为实物锚点，提升免费用户转付费的概率。
*   **公式**：
    1.  **新增付费人数** = `Free磁贴数` × `Conversion Rate (10%)`
    2.  **单客首年净利 (K)** = `ARPPU` × `(1 - 平台分成10%)` × `毛利(80%)` × `12个月`
    3.  **增长总收益** = `新增付费人数` × `单客首年净利`

### Track B: Retention (留存收益) 深度解析
*   *注意：仅适用于 Plan B*

#### 核心逻辑：为什么磁贴能通过改善流失率来增加 LTV？
我们假设原来的用户生命周期是 `L0` (例如 7 个月)，这对应一个隐含的月流失率 `c = 1/L0` (例如 1/7 ≈ 14.2%)。
如果我们通过赠送磁贴，让用户的流失意愿降低了 `u` (Churn Improvement, 默认 8%)，那么新的流失率变为 `c_new = c * (1 - u)`。

#### 数学推导 (The Math)
1.  **原生命周期**: `L0 = 1 / c`
2.  **新生命周期**: `L_new = 1 / c_new = 1 / (c * (1 - u))`
3.  **生命周期延长 (ΔL)**:
    ```
    ΔL = L_new - L0
       = (1 / (c * (1-u))) - (1/c)
       = (1/c) * [ (1 / (1-u)) - 1 ]
       = L0 * [ u / (1-u) ]
    ```
    *这就是代码中 `deltaL = (u / (1 - u)) * avgLifetimeMonths` 的由来。*

#### 计算步骤
1.  **计算单个用户的 LTV 延长量 (ΔL)**:
    *   例如：`L0 = 7个月`, `u = 8%`
    *   `ΔL = 7 * (0.08 / 0.92) ≈ 0.61 个月`
    *   这意味着：每个被成功“挽留”的用户，平均会多付 0.61 个月的钱。

2.  **计算有效覆盖 (Effective Scope)**:
    *   并不是所有收到磁贴的付费用户都会养成习惯。我们假设覆盖率 `a = 50%`。
    *   **有效延长时间** = `M_paid` (收到磁贴的人) × `a` (覆盖率) × `ΔL` (延长时间)

3.  **计算总收益**:
    *   **Retention Profit** = `所有赢回的有效付费月数` × `单月净利`

通过微小的流失率改善 (8%)，在大量用户基数下，通过延长用户的“存活时间”，能累积出可观的额外利润。

### 总 ROI (Total ROI)
*   **总收益 (Total Gain)** = `增长收益` + `留存收益`
*   **总成本 (Pilot Cost)** = `Total Magnets` × `$20`
*   **净收益 (Net Gain)** = `总收益` - `总成本`
